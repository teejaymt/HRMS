# Employee Hierarchy - Visual Structure Guide

## ðŸ“Š Organizational Hierarchy Levels

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CEO                             â”‚
â”‚                  (JobLevel: CEO)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚    VP    â”‚              â”‚    VP     â”‚
    â”‚ (Level: VP)â”‚            â”‚ (Level: VP)â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ DIRECTOR â”‚              â”‚ DIRECTOR  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ SENIOR_MANAGERâ”‚          â”‚SENIOR_MANAGER â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ MANAGER  â”‚              â”‚  MANAGER  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
    â”‚ TEAM_LEAD â”‚              â”‚ TEAM_LEAD â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚SUPERVISOR â”‚              â”‚ SUPERVISOR â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
         â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
    â”‚EMPLOYEE â”‚EMP â”‚EMP â”‚      â”‚EMPLOYEE â”‚EMP â”‚EMP â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
```

## ðŸ—„ï¸ Database Structure

### Employee Table
```
Employee {
  id: number
  firstName: string
  lastName: string
  employeeCode: string
  position: string
  
  // NEW HIERARCHY FIELDS
  jobLevel: JobLevel (enum)
  supervisorId: number | null  â† Points to supervisor's id
  
  // RELATIONS
  supervisor: Employee         â† The employee's manager
  subordinates: Employee[]     â† Array of direct reports
}
```

### Example Data
```sql
-- CEO (No supervisor)
id: 1, name: "Sarah Johnson", jobLevel: CEO, supervisorId: NULL

-- VP (Reports to CEO)
id: 2, name: "Mike Chen", jobLevel: VP, supervisorId: 1

-- Manager (Reports to VP)
id: 3, name: "Jane Smith", jobLevel: MANAGER, supervisorId: 2

-- Team Lead (Reports to Manager)
id: 4, name: "John Doe", jobLevel: TEAM_LEAD, supervisorId: 3

-- Employee (Reports to Team Lead)
id: 5, name: "Bob Wilson", jobLevel: EMPLOYEE, supervisorId: 4
```

## ðŸ”„ API Data Flow

### Getting Hierarchy
```
Client Request:
GET /employees/4/hierarchy

Backend Process:
1. Find employee (id: 4)
2. Get ancestors (supervisors up)
   - id: 3 (Manager)
   - id: 2 (VP)
   - id: 1 (CEO)
3. Get descendants (subordinates down)
   - id: 5 (Employee)
   - id: 6 (Employee)

Response:
{
  employee: { id: 4, name: "John Doe", jobLevel: "TEAM_LEAD" },
  ancestors: [
    { id: 3, name: "Jane Smith", jobLevel: "MANAGER" },
    { id: 2, name: "Mike Chen", jobLevel: "VP" },
    { id: 1, name: "Sarah Johnson", jobLevel: "CEO" }
  ],
  descendants: [
    { id: 5, name: "Bob Wilson", jobLevel: "EMPLOYEE" },
    { id: 6, name: "Alice Brown", jobLevel: "EMPLOYEE" }
  ]
}
```

## ðŸŽ¨ Frontend Component Structure

```
HierarchyPage
â”œâ”€â”€ Employee List Panel (Left)
â”‚   â”œâ”€â”€ Search Bar
â”‚   â””â”€â”€ Employee Cards
â”‚       â””â”€â”€ Click to load hierarchy
â”‚
â””â”€â”€ Hierarchy View Panel (Right)
    â”œâ”€â”€ Ancestors Section (Reports To)
    â”‚   â””â”€â”€ Shows chain of managers
    â”‚
    â”œâ”€â”€ Current Employee (Highlighted)
    â”‚   â””â”€â”€ Selected employee details
    â”‚
    â””â”€â”€ Descendants Section (Direct Reports)
        â””â”€â”€ Expandable tree of subordinates
```

## ðŸ” Circular Reference Prevention

### âŒ INVALID Assignment
```
Employee A (id: 1)
  â””â”€â”€ Employee B (id: 2)
      â””â”€â”€ Employee C (id: 3)

Trying to assign: A.supervisorId = 3
Result: BLOCKED - Creates circular reference!

Chain would be: A â†’ B â†’ C â†’ A (circular!)
```

### âœ… VALID Assignment
```
Employee A (id: 1)
  â””â”€â”€ Employee B (id: 2)
      â””â”€â”€ Employee C (id: 3)

Assign: C.supervisorId = 1
Result: ALLOWED

New structure:
Employee A (id: 1)
  â”œâ”€â”€ Employee B (id: 2)
  â””â”€â”€ Employee C (id: 3)
```

## ðŸ“± User Interface Flow

### 1. View Hierarchy
```
User â†’ Navigates to /employees/hierarchy
     â†’ Sees list of all employees
     â†’ Clicks on "John Doe"
     â†’ System fetches hierarchy
     â†’ Displays org chart
```

### 2. Navigate Up (View Manager)
```
Viewing: John Doe (Team Lead)
Reports to: Jane Smith (Manager) â† Click here
     â†’ Loads Jane's hierarchy
     â†’ Shows Jane's manager
     â†’ Shows Jane's team (including John)
```

### 3. Navigate Down (View Team Member)
```
Viewing: John Doe (Team Lead)
Direct Reports:
  - Bob Wilson (Employee) â† Click here
     â†’ Loads Bob's hierarchy
     â†’ Shows Bob's manager (John)
     â†’ Shows Bob's team (if any)
```

## ðŸ› ï¸ Implementation Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Frontend (Next.js)                  â”‚
â”‚                                                      â”‚
â”‚  Components:                                         â”‚
â”‚  - HierarchyPage                                    â”‚
â”‚  - EmployeeList                                      â”‚
â”‚  - HierarchyTree                                     â”‚
â”‚  - EmployeeNode                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ HTTP REST API
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Backend (NestJS)                        â”‚
â”‚                                                      â”‚
â”‚  Controllers:                                        â”‚
â”‚  - EmployeesController                               â”‚
â”‚    â””â”€â”€ GET /employees/:id/hierarchy                 â”‚
â”‚                                                      â”‚
â”‚  Services:                                           â”‚
â”‚  - EmployeesService                                  â”‚
â”‚    â”œâ”€â”€ getHierarchy()                               â”‚
â”‚    â”œâ”€â”€ getAncestors() (recursive)                   â”‚
â”‚    â””â”€â”€ getDescendants() (recursive)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Prisma ORM
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Database (SQLite/PostgreSQL)            â”‚
â”‚                                                      â”‚
â”‚  Tables:                                             â”‚
â”‚  - Employee                                          â”‚
â”‚    â”œâ”€â”€ id (PK)                                      â”‚
â”‚    â”œâ”€â”€ supervisorId (FK â†’ Employee.id)              â”‚
â”‚    â”œâ”€â”€ jobLevel (enum)                              â”‚
â”‚    â””â”€â”€ ... other fields                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ“Š Example Use Cases

### Use Case 1: Leave Approval Chain
```
Employee submits leave request
  â†’ System finds supervisor
  â†’ Routes to Team Lead
  â†’ If amount > threshold, escalates to Manager
  â†’ Manager approves
  â†’ HR notified
```

### Use Case 2: Team View
```
Manager logs in
  â†’ Dashboard shows "Your Team: 12 members"
  â†’ Click to view team
  â†’ See all direct + indirect reports
  â†’ Quick actions available
```

### Use Case 3: Org Chart Export
```
HR needs org chart
  â†’ Navigate to hierarchy
  â†’ Select CEO
  â†’ Click "Export"
  â†’ PDF generated with full tree
```

## ðŸŽ¯ Key Features Summary

| Feature | Description | Status |
|---------|-------------|--------|
| Hierarchy Levels | 8 job levels from Employee to CEO | âœ… Implemented |
| Supervisor Assignment | Link employees to managers | âœ… Implemented |
| Circular Prevention | Block invalid assignments | âœ… Implemented |
| Tree Navigation | Click to navigate org structure | âœ… Implemented |
| Recursive Queries | Get full reporting chain | âœ… Implemented |
| Visual Indicators | Color-coded job levels | âœ… Implemented |
| Search & Filter | Find employees quickly | âœ… Implemented |
| API Endpoints | 4 new RESTful endpoints | âœ… Implemented |

---

**This visual guide helps understand the hierarchy system structure and flow.**
**Refer to HIERARCHY_SETUP_GUIDE.md for installation instructions.**
